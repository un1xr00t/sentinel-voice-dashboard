{
  "name": "SENTINEL Voice Query API",
  "nodes": [
    {
      "parameters": {
        "content": "## ðŸŽ™ï¸ SENTINEL Voice Query API\n\n**Endpoints:**\n1. POST /sentinel-voice-query - Voice queries from Retell\n2. GET /sentinel-dashboard - Dashboard data API\n3. POST /sentinel-retell-token - Get Retell access token\n\n**Setup:**\n1. Deploy this workflow\n2. Update Retell API key in credentials\n3. Point dashboard to webhook URLs",
        "height": 420,
        "width": 340,
        "color": 5
      },
      "id": "5247e64e-fd5a-4665-bc5c-d41d7f2cf83e",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2368,
        16
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sentinel-voice-query",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "65f9f050-6d8a-44b7-8101-daf0becff1e0",
      "name": "Voice Query Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2768,
        320
      ],
      "webhookId": "sentinel-voice"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// SENTINEL Voice Query - Parse Intent\n// ============================================================\nconst body = $input.first().json.body || $input.first().json;\n\n// Get query from Retell - it's in body.args.query directly\nconst query = (body.args?.query || body.query || '').toLowerCase();\n\n// Determine query intent\nlet intent = 'general_briefing';\nlet filters = {\n  timeframe: 'week',\n  priority: null,\n  vendor: null,\n  threatType: null,\n  cveId: null\n};\n\n// Time parsing\nif (query.includes('today') || query.includes('latest') || query.includes('recent')) {\n  filters.timeframe = 'today';\n} else if (query.includes('yesterday')) {\n  filters.timeframe = 'yesterday';\n} else if (query.includes('week') || query.includes('past 7')) {\n  filters.timeframe = 'week';\n} else if (query.includes('month')) {\n  filters.timeframe = 'month';\n}\n\n// Priority parsing\nif (query.includes('critical')) {\n  filters.priority = 'CRITICAL';\n  intent = 'priority_filter';\n} else if (query.includes('high priority') || query.includes('high-priority')) {\n  filters.priority = 'HIGH';\n  intent = 'priority_filter';\n}\n\n// Threat type parsing\nif (query.includes('ransomware')) {\n  filters.threatType = 'ransomware';\n  intent = 'threat_type';\n} else if (query.includes('zero-day') || query.includes('zero day') || query.includes('0day')) {\n  filters.threatType = 'zero-day';\n  intent = 'threat_type';\n} else if (query.includes('malware')) {\n  filters.threatType = 'malware';\n  intent = 'threat_type';\n} else if (query.includes('phishing')) {\n  filters.threatType = 'phishing';\n  intent = 'threat_type';\n}\n\n// Vendor parsing\nconst vendors = ['microsoft', 'cisco', 'vmware', 'apache', 'linux', 'windows', 'google', 'apple', 'oracle', 'adobe', 'fortinet', 'palo alto', 'crowdstrike'];\nfor (const vendor of vendors) {\n  if (query.includes(vendor)) {\n    filters.vendor = vendor;\n    intent = 'vendor_filter';\n    break;\n  }\n}\n\n// CVE specific query\nconst cveMatch = query.match(/cve-\\d{4}-\\d{4,7}/i);\nif (cveMatch) {\n  filters.cveId = cveMatch[0].toUpperCase();\n  intent = 'cve_lookup';\n}\n\n// Special intents\nif (query.includes('threat level') || query.includes('status') || query.includes('how bad')) {\n  intent = 'threat_level';\n} else if (query.includes('brief me') || query.includes('briefing') || query.includes('summary') || query.includes('overview')) {\n  intent = 'executive_briefing';\n} else if (query.includes('count') || query.includes('how many')) {\n  intent = 'count_query';\n}\n\nreturn [{\n  json: {\n    originalQuery: query,\n    intent,\n    filters,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "6bc705b3-8cf7-4bc5-a06a-849af4c87b5f",
      "name": "Parse Query Intent",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2992,
        320
      ]
    },
    {
      "parameters": {
        "jsCode": "// Build Time Filter - EST timezone aware\nconst { filters } = $input.first().json;\nconst now = new Date();\n\n// Offset for EST (-5 hours) - CHANGE THIS TO YOUR TIMEZONE\nconst estOffset = -5 * 60 * 60 * 1000;\nconst nowEST = new Date(now.getTime() + (now.getTimezoneOffset() * 60 * 1000) + estOffset);\n\nlet startDate;\n\nswitch (filters.timeframe) {\n  case 'today':\n    startDate = new Date(nowEST);\n    startDate = new Date(Date.now() - 24 * 60 * 60 * 1000);\n    break;\n  case 'yesterday':\n    startDate = new Date(nowEST);\n    startDate.setDate(startDate.getDate() - 1);\n    startDate.setHours(0, 0, 0, 0);\n    break;\n  case 'week':\n    startDate = new Date(nowEST);\n    startDate.setDate(startDate.getDate() - 7);\n    break;\n  case 'month':\n    startDate = new Date(nowEST);\n    startDate.setDate(startDate.getDate() - 30);\n    break;\n  default:\n    startDate = new Date(nowEST);\n    startDate.setDate(startDate.getDate() - 7);\n}\n\nreturn [{\n  json: {\n    ...$input.first().json,\n    startDate: startDate.toISOString(),\n    endDate: now.toISOString()\n  }\n}];"
      },
      "id": "d45eb75c-9266-495b-aacf-4685384888e5",
      "name": "Build Time Filter",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3216,
        320
      ]
    },
    {
      "parameters": {
        "databaseId": "YOUR_DATABASE_ID",
        "tableId": "YOUR_TABLE_ID",
        "returnAll": true,
        "additionalOptions": {}
      },
      "id": "ec719cba-70c7-4e54-8a9e-27a486650ab1",
      "name": "Query SENTINEL Database",
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        3440,
        320
      ],
      "credentials": {
        "baserowApi": {
          "id": "YOUR_BASEROW_CREDENTIAL_ID",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// SENTINEL Voice Query - Filter & Analyze Results  \n// ============================================================\n\nconst queryData = $('Build Time Filter').first().json;\nconst allAlerts = $('Query SENTINEL Database').all();\n\nconst { intent, filters, startDate } = queryData;\nconst startDateTime = new Date(startDate);\n\n// Filter alerts by time\nlet filteredAlerts = allAlerts.filter(item => {\n  const alertDate = new Date(item.json.sent_at || item.json.created_on);\n  return alertDate >= startDateTime;\n});\n\n// Apply additional filters based on TITLE since we only store fingerprint, title, sent_at\nif (filters.priority) {\n  const priorityKeywords = {\n    'CRITICAL': ['critical', 'cisa kev', 'actively exploited', 'zero-day', '0-day'],\n    'HIGH': ['high', 'rce', 'remote code execution', 'ransomware']\n  };\n  const keywords = priorityKeywords[filters.priority] || [];\n  filteredAlerts = filteredAlerts.filter(item => {\n    const title = (item.json.title || '').toLowerCase();\n    return keywords.some(kw => title.includes(kw));\n  });\n}\n\nif (filters.vendor) {\n  filteredAlerts = filteredAlerts.filter(item => \n    (item.json.title || '').toLowerCase().includes(filters.vendor)\n  );\n}\n\nif (filters.threatType) {\n  filteredAlerts = filteredAlerts.filter(item => \n    (item.json.title || '').toLowerCase().includes(filters.threatType)\n  );\n}\n\nif (filters.cveId) {\n  filteredAlerts = filteredAlerts.filter(item => \n    (item.json.title || '').toUpperCase().includes(filters.cveId)\n  );\n}\n\n// Calculate statistics based on title analysis\nconst criticalKeywords = ['critical', 'cisa kev', 'actively exploited', 'zero-day', '0-day', 'emergency'];\nconst highKeywords = ['high', 'rce', 'remote code execution', 'ransomware', 'authentication bypass'];\n\nconst stats = {\n  total: filteredAlerts.length,\n  critical: filteredAlerts.filter(a => {\n    const title = (a.json.title || '').toLowerCase();\n    return criticalKeywords.some(kw => title.includes(kw));\n  }).length,\n  high: filteredAlerts.filter(a => {\n    const title = (a.json.title || '').toLowerCase();\n    return highKeywords.some(kw => title.includes(kw)) && !criticalKeywords.some(kw => title.includes(kw));\n  }).length,\n  medium: 0,\n  withCVE: filteredAlerts.filter(a => (a.json.title || '').toUpperCase().includes('CVE-')).length\n};\nstats.medium = Math.max(0, stats.total - stats.critical - stats.high);\n\n// Determine threat level\nlet threatLevel = 'LOW';\nlet threatLevelDescription = 'Normal operations';\n\nif (stats.critical >= 3) {\n  threatLevel = 'CRITICAL';\n  threatLevelDescription = 'Multiple critical threats detected - immediate attention required';\n} else if (stats.critical >= 1) {\n  threatLevel = 'HIGH';\n  threatLevelDescription = 'Critical threat detected - review recommended';\n} else if (stats.high >= 5) {\n  threatLevel = 'ELEVATED';\n  threatLevelDescription = 'Multiple high-priority threats - increased vigilance advised';\n} else if (stats.total >= 10) {\n  threatLevel = 'GUARDED';\n  threatLevelDescription = 'Elevated activity - monitor situation';\n}\n\n// Get top alerts for briefing\nconst topAlerts = filteredAlerts\n  .sort((a, b) => new Date(b.json.sent_at || b.json.created_on) - new Date(a.json.sent_at || a.json.created_on))\n  .slice(0, 5)\n  .map(a => ({\n    title: a.json.title\n  }));\n\nreturn [{\n  json: {\n    queryData,\n    stats,\n    threatLevel,\n    threatLevelDescription,\n    topAlerts,\n    totalResults: filteredAlerts.length\n  }\n}];"
      },
      "id": "803df32a-505b-4950-bdfb-5252d7ef74e9",
      "name": "Filter & Analyze",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3648,
        320
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"gpt-4o-mini\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"You are SENTINEL, a cybersecurity threat intelligence analyst giving voice briefings. Be concise, direct, and speak naturally. Say CVE as 'C-V-E' followed by the number. No bullet points or markdown - this is spoken out loud. Start directly with information, no 'Sure!' or 'Here's what I found'. Keep responses to 2-4 sentences.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": {{ JSON.stringify(\"Query: \" + $json.queryData.originalQuery + \"\\n\\nThreat Data:\\n- Current Threat Level: \" + $json.threatLevel + \" (\" + $json.threatLevelDescription + \")\\n- Total Alerts: \" + $json.stats.total + \"\\n- Critical: \" + $json.stats.critical + \"\\n- High: \" + $json.stats.high + \"\\n- Medium: \" + $json.stats.medium + \"\\n- Alerts with CVEs: \" + $json.stats.withCVE + \"\\n\\nTop Recent Alerts:\\n\" + $json.topAlerts.map(a => a.title).join(\"\\n\") + \"\\n\\nProvide a brief spoken response based on this data.\") }}\n    }\n  ],\n  \"max_tokens\": 300,\n  \"temperature\": 0.3\n}",
        "options": {
          "timeout": 30000
        }
      },
      "id": "898c0d3c-ae28-478d-ab07-67ef6948b20c",
      "name": "Generate Voice Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3872,
        320
      ],
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAI account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// SENTINEL Voice Query - Format Response for Retell\n// ============================================================\n\nconst analysisData = $('Filter & Analyze').first().json;\nconst aiResponse = $input.first().json;\n\nlet spokenResponse = '';\n\ntry {\n  if (aiResponse.choices && aiResponse.choices[0] && aiResponse.choices[0].message) {\n    spokenResponse = aiResponse.choices[0].message.content;\n  }\n} catch (e) {\n  const { stats, threatLevel } = analysisData;\n  spokenResponse = `Current threat level is ${threatLevel}. I've detected ${stats.total} alerts, including ${stats.critical} critical and ${stats.high} high priority items. ${stats.critical > 0 ? 'Immediate review is recommended.' : 'No immediate action required.'}`;\n}\n\nspokenResponse = spokenResponse\n  .replace(/\\*\\*/g, '')\n  .replace(/\\*/g, '')\n  .replace(/\\n/g, ' ')\n  .replace(/- /g, '')\n  .replace(/CVE-/g, 'C-V-E ')\n  .trim();\n\nreturn [{\n  json: {\n    response: spokenResponse,\n    data: {\n      threatLevel: analysisData.threatLevel,\n      stats: analysisData.stats,\n      topAlerts: analysisData.topAlerts\n    },\n    success: true\n  }\n}];"
      },
      "id": "1201b459-727e-4de9-88fd-448ce8319e7d",
      "name": "Format for Retell",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4096,
        320
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {}
      },
      "id": "d134d9d8-79f2-4067-8f44-8f093470c916",
      "name": "Send Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        4320,
        320
      ]
    },
    {
      "parameters": {
        "content": "## ðŸ“Š Dashboard API Endpoint\n\nReturns real-time data for the SENTINEL dashboard.",
        "height": 120,
        "width": 300,
        "color": 3
      },
      "id": "256b1747-0848-4a23-9ae2-2a7452fd43f9",
      "name": "Dashboard Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2368,
        576
      ]
    },
    {
      "parameters": {
        "path": "sentinel-dashboard",
        "responseMode": "responseNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "4a5c9cb4-6c0a-4f81-b4e7-36953c8f8b12",
      "name": "Dashboard API",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2768,
        672
      ],
      "webhookId": "sentinel-dashboard"
    },
    {
      "parameters": {
        "databaseId": "YOUR_DATABASE_ID",
        "tableId": "YOUR_TABLE_ID",
        "returnAll": true,
        "additionalOptions": {}
      },
      "id": "361dbaad-5e53-45f0-adb1-4e266de1276b",
      "name": "Get All Alerts",
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        2992,
        672
      ],
      "credentials": {
        "baserowApi": {
          "id": "YOUR_BASEROW_CREDENTIAL_ID",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// SENTINEL Dashboard - Build Dashboard Data\n// Works with existing Baserow fields: fingerprint, title, sent_at\n// ============================================================\n\nconst allAlerts = $input.all();\nconst now = new Date();\nconst today = new Date(Date.now() - 24 * 60 * 60 * 1000);\nconst weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n\nconst recentAlerts = allAlerts.filter(item => {\n  const alertDate = new Date(item.json.sent_at || item.json.created_on);\n  return alertDate >= weekAgo;\n});\n\nconst todayAlerts = recentAlerts.filter(item => {\n  const alertDate = new Date(item.json.sent_at || item.json.created_on);\n  return alertDate >= today;\n});\n\nconst criticalKeywords = ['critical', 'cisa kev', 'actively exploited', 'zero-day', '0-day', 'emergency'];\nconst highKeywords = ['high', 'rce', 'remote code execution', 'ransomware', 'authentication bypass', 'privilege escalation'];\n\nfunction getPriority(title) {\n  const t = (title || '').toLowerCase();\n  if (criticalKeywords.some(kw => t.includes(kw))) return 'CRITICAL';\n  if (highKeywords.some(kw => t.includes(kw))) return 'HIGH';\n  return 'MEDIUM';\n}\n\nfunction getSource(title) {\n  const t = (title || '').toLowerCase();\n  \n  // Government/Official\n  if (t.includes('cisa') || t.includes('kev') || t.includes('us-cert')) return 'CISA';\n  if (t.includes('nist') || t.includes('nvd')) return 'NIST/NVD';\n  \n  // Vendors\n  if (t.includes('microsoft') || t.includes('msrc')) return 'Microsoft';\n  if (t.includes('cisco') || t.includes('webex') || t.includes('ios xe')) return 'Cisco';\n  if (t.includes('google') || t.includes('chrome') || t.includes('android') || t.includes('gcp')) return 'Google';\n  if (t.includes('apple') || t.includes('macos') || t.includes('ios') || t.includes('webkit')) return 'Apple';\n  if (t.includes('adobe') || t.includes('acrobat') || t.includes('photoshop')) return 'Adobe';\n  if (t.includes('vmware') || t.includes('esxi') || t.includes('vcenter')) return 'VMware';\n  if (t.includes('oracle') || t.includes('java')) return 'Oracle';\n  if (t.includes('fortinet') || t.includes('fortigate') || t.includes('fortios')) return 'Fortinet';\n  if (t.includes('palo alto') || t.includes('pan-os')) return 'Palo Alto';\n  if (t.includes('linux') || t.includes('ubuntu') || t.includes('debian') || t.includes('redhat') || t.includes('kernel')) return 'Linux';\n  \n  // Threat Intel\n  if (t.includes('ransomware') || t.includes('lockbit') || t.includes('alphv') || t.includes('blackcat')) return 'Ransomware';\n  if (t.includes('apt') || t.includes('threat actor') || t.includes('nation-state')) return 'APT/Threat Actors';\n  if (t.includes('malware') || t.includes('trojan') || t.includes('botnet')) return 'Malware';\n  if (t.includes('phishing') || t.includes('credential')) return 'Phishing';\n  if (t.includes('threatfox') || t.includes('ioc')) return 'ThreatFox IOCs';\n  \n  // Research\n  if (t.includes('exploit-db') || t.includes('exploitdb') || t.includes('proof of concept') || t.includes('poc')) return 'Exploit Research';\n  if (t.includes('zero-day') || t.includes('0-day') || t.includes('zeroday')) return 'Zero-Day';\n  \n  // CVE-focused\n  if (t.match(/cve-\\d{4}-\\d+/i)) return 'CVE Reports';\n  \n  return 'Security News';\n}\n\nconst stats = {\n  total: recentAlerts.length,\n  today: todayAlerts.length,\n  critical: recentAlerts.filter(a => getPriority(a.json.title) === 'CRITICAL').length,\n  high: recentAlerts.filter(a => getPriority(a.json.title) === 'HIGH').length,\n  medium: recentAlerts.filter(a => getPriority(a.json.title) === 'MEDIUM').length,\n  low: 0\n};\n\nlet threatLevel = 'LOW';\nlet threatScore = 25;\n\nif (stats.critical >= 3) {\n  threatLevel = 'CRITICAL';\n  threatScore = 95;\n} else if (stats.critical >= 1) {\n  threatLevel = 'HIGH';\n  threatScore = 75;\n} else if (stats.high >= 5) {\n  threatLevel = 'ELEVATED';\n  threatScore = 60;\n} else if (stats.total >= 10) {\n  threatLevel = 'GUARDED';\n  threatScore = 45;\n}\n\nconst hourlyTrend = [];\nfor (let i = 23; i >= 0; i--) {\n  const hourStart = new Date(Date.now() - i * 60 * 60 * 1000);\n  const hourEnd = new Date(Date.now() - (i - 1) * 60 * 60 * 1000);\n  \n  const count = recentAlerts.filter(a => {\n    const d = new Date(a.json.sent_at || a.json.created_on);\n    return d >= hourStart && d < hourEnd;\n  }).length;\n  \n  hourlyTrend.push({\n    hour: hourStart.getHours(),\n    count,\n    label: hourStart.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })\n  });\n}\n\nconst sourceMap = {};\nrecentAlerts.forEach(a => {\n  const source = getSource(a.json.title);\n  sourceMap[source] = (sourceMap[source] || 0) + 1;\n});\n\nconst sourceBreakdown = Object.entries(sourceMap)\n  .map(([name, count]) => ({ name, count }))\n  .sort((a, b) => b.count - a.count)\n  .slice(0, 10);\n\nconst alertFeed = recentAlerts\n  .sort((a, b) => new Date(b.json.sent_at || b.json.created_on) - new Date(a.json.sent_at || a.json.created_on))\n  .slice(0, 20)\n  .map(a => {\n    const title = a.json.title || 'Unknown Alert';\n    const cveMatches = title.match(/CVE-\\d{4}-\\d{4,7}/gi) || [];\n    return {\n      id: a.json.id,\n      title: title,\n      priority: getPriority(title),\n      source: getSource(title),\n      timestamp: a.json.sent_at || a.json.created_on,\n      cves: cveMatches.map(c => c.toUpperCase())\n    };\n  });\n\nreturn [{\n  json: {\n    threatLevel,\n    threatScore,\n    stats,\n    hourlyTrend,\n    sourceBreakdown,\n    alertFeed,\n    lastUpdated: new Date().toISOString()\n  }\n}];"
      },
      "id": "98da25eb-eaaa-49bb-8de7-807a5003d5ab",
      "name": "Build Dashboard Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3216,
        672
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {}
      },
      "id": "d48121fa-19df-4dfa-92bc-cc870c1c8893",
      "name": "Dashboard Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        3440,
        672
      ]
    },
    {
      "parameters": {
        "content": "## ðŸ”‘ Retell Token Endpoint\n\nGenerates access token for web-based voice calls.",
        "height": 120,
        "width": 300,
        "color": 4
      },
      "id": "ca30d397-3bf2-4fbe-9187-346c4e7c28bf",
      "name": "Retell Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2368,
        816
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sentinel-retell-token",
        "responseMode": "responseNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type"
              }
            ]
          }
        }
      },
      "id": "2558dc28-7c13-478b-b16b-1a9e045a4867",
      "name": "Retell Token Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2768,
        928
      ],
      "webhookId": "sentinel-retell-token"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.retellai.com/v2/create-web-call",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer YOUR_RETELL_API_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"agent_id\": \"YOUR_RETELL_AGENT_ID\"\n}",
        "options": {
          "timeout": 10000
        }
      },
      "id": "a1dd49e9-e021-45e0-875f-5cd4efe3a917",
      "name": "Create Retell Web Call",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2992,
        928
      ]
    },
    {
      "parameters": {
        "jsCode": "// Format response for frontend\nconst response = $input.first().json;\n\nif (response.access_token) {\n  return [{\n    json: {\n      success: true,\n      access_token: response.access_token,\n      call_id: response.call_id\n    }\n  }];\n} else {\n  return [{\n    json: {\n      success: false,\n      error: 'Failed to get access token from Retell'\n    }\n  }];\n}"
      },
      "id": "56515712-ef9b-45d4-aba1-31c5f6e7e240",
      "name": "Format Retell Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3216,
        928
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "options": {}
      },
      "id": "46b08626-0f44-4f53-b0da-5755ad83c55c",
      "name": "Retell Token Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        3440,
        928
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Voice Query Webhook": {
      "main": [
        [
          {
            "node": "Parse Query Intent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Query Intent": {
      "main": [
        [
          {
            "node": "Build Time Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Time Filter": {
      "main": [
        [
          {
            "node": "Query SENTINEL Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Query SENTINEL Database": {
      "main": [
        [
          {
            "node": "Filter & Analyze",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Analyze": {
      "main": [
        [
          {
            "node": "Generate Voice Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Voice Response": {
      "main": [
        [
          {
            "node": "Format for Retell",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format for Retell": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dashboard API": {
      "main": [
        [
          {
            "node": "Get All Alerts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Alerts": {
      "main": [
        [
          {
            "node": "Build Dashboard Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Dashboard Data": {
      "main": [
        [
          {
            "node": "Dashboard Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retell Token Webhook": {
      "main": [
        [
          {
            "node": "Create Retell Web Call",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Retell Web Call": {
      "main": [
        [
          {
            "node": "Format Retell Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Retell Response": {
      "main": [
        [
          {
            "node": "Retell Token Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "meta": {
    "instanceId": ""
  },
  "tags": [
    {
      "name": "sentinel"
    },
    {
      "name": "retell"
    },
    {
      "name": "voice"
    }
  ]
}
